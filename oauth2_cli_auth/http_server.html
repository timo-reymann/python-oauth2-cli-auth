<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>oauth2_cli_auth.http_server API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>oauth2_cli_auth.http_server</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from http.server import BaseHTTPRequestHandler, HTTPServer
from string import Template
from typing import Optional
from urllib.parse import parse_qs, urlparse
from oauth2_cli_auth._timeout import _method_with_timeout, TimeoutException


class CallbackPageTemplate:
    SUCCESS_SVG = &#34;&#34;&#34;
    &lt;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; width=&#34;154px&#34; height=&#34;154px&#34;&gt;
        &lt;g fill=&#34;none&#34; stroke=&#34;#22AE73&#34; stroke-width=&#34;2&#34;&gt;
            &lt;circle cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;circle id=&#34;colored&#34; fill=&#34;#22AE73&#34; cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;polyline class=&#34;st0&#34; stroke=&#34;#fff&#34; stroke-width=&#34;10&#34; points=&#34;43.5,77.8 63.7,97.9 112.2,49.4 &#34; style=&#34;stroke-dasharray:100px, 100px; stroke-dashoffset: 200px;&#34;/&gt;
        &lt;/g&gt;
    &lt;/svg&gt;
    &#34;&#34;&#34;

    ERROR_SVG = &#34;&#34;&#34;
    &lt;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; width=&#34;154px&#34; height=&#34;154px&#34;&gt;
        &lt;g fill=&#34;none&#34; stroke=&#34;#F44812&#34; stroke-width=&#34;2&#34;&gt;
            &lt;circle cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;circle id=&#34;colored&#34; fill=&#34;#F44812&#34; cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;polyline class=&#34;st0&#34; stroke=&#34;#fff&#34; stroke-width=&#34;10&#34; points=&#34;43.5,77.8  112.2,77.8 &#34; style=&#34;stroke-dasharray:100px, 100px; stroke-dashoffset: 200px;&#34;/&gt;
        &lt;/g&gt;
    &lt;/svg&gt;
    &#34;&#34;&#34;

    PAGE_TEMPLATE = Template(&#34;&#34;&#34;
    &lt;html lang=&#34;$lang&#34;&gt;
        &lt;head&gt;
            &lt;title&gt;$title&lt;/title&gt;
            &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;/&gt;
            &lt;meta name=&#34;charset&#34; content=&#34;utf-8&#34;&gt;
            &lt;style&gt;
                * {
                    margin: 0;
                    padding: 0;
                }

                body {
                    font-family: -apple-system, BlinkMacSystemFont, &#34;Segoe UI&#34;, Roboto, Helvetica, Arial, sans-serif, &#34;Apple Color Emoji&#34;, &#34;Segoe UI Emoji&#34;, &#34;Segoe UI Symbol&#34;;
                }

                @media (prefers-color-scheme: dark) {
                    body {
                        background: rgb(34, 39, 46);
                        color: rgb(173, 186, 199);
                    }
                }

                html, body {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    height: 100%;
                }

                h1 {
                    font-size: 4rem;
                }

                p {
                    font-size: 1.4rem;
                    max-width: 70ch;
                }

                .message {
                    text-align: center;
                }

                .animation-ctn {
                    text-align: center;
                }

                @keyframes checkmark {
                    0% {
                        stroke-dashoffset: 100px
                    }

                    100% {
                        stroke-dashoffset: 0px
                    }
                }

                @keyframes checkmark-circle {
                    0% {
                        stroke-dashoffset: 480px
                    }

                    100% {
                        stroke-dashoffset: 960px
                    }
                }

                @keyframes colored-circle {
                    0% {
                        opacity: 0
                    }

                    100% {
                        opacity: 100
                    }
                }

                .icon svg {
                    padding: 1rem;
                }

                .icon svg polyline {
                    -webkit-animation: checkmark 0.25s ease-in-out 0.7s backwards;
                    animation: checkmark 0.25s ease-in-out 0.7s backwards
                }

                .icon svg circle {
                    -webkit-animation: checkmark-circle 0.6s ease-in-out backwards;
                    animation: checkmark-circle 0.6s ease-in-out backwards;
                }

                .icon svg circle#colored {
                    -webkit-animation: colored-circle 0.6s ease-in-out 0.7s backwards;
                    animation: colored-circle 0.6s ease-in-out 0.7s backwards;
                }
            &lt;/style&gt;
        &lt;/head&gt;

        &lt;body&gt;
        &lt;div class=&#34;message&#34;&gt;
            &lt;div class=&#34;animation-ctn&#34;&gt;
                &lt;div class=&#34;icon&#34;&gt;
                    $svg
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;h1&gt;$title&lt;/h1&gt;
            &lt;p&gt;$message&lt;/p&gt;
        &lt;/div&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        &#34;&#34;&#34;)

    def render(self, title: str, message: str, lang: str = &#34;en&#34;, has_error: bool = False):
        return self.PAGE_TEMPLATE.substitute(
            lang=lang,
            title=title,
            message=message,
            svg=self.ERROR_SVG if has_error else self.SUCCESS_SVG,
        )


class OAuthRedirectHandler(BaseHTTPRequestHandler):
    callback_template = CallbackPageTemplate()

    def log_message(self, format, *args):
        # silence the log messages
        pass

    def do_GET(self):
        params = parse_qs(urlparse(self.path).query)

        has_error = &#34;code&#34; not in params or len(params[&#39;code&#39;]) != 1 or params[&#39;code&#39;][0].strip() == &#34;&#34;

        if has_error:
            self.send_response(400)
            title = &#34;Oh snap!&#34;
            message = &#34;Something went wrong trying to authenticate you. Please try going back in your browser, or restart the auth process.&#34;
        else:
            self.send_response(200)
            self.server._code = params[&#34;code&#34;][0]
            title = &#34;Success&#34;
            message = &#34;You have been authenticated successfully. You may close this browser window now and go back to the terminal&#34;

        self.send_header(&#34;Content-type&#34;, &#34;text/html&#34;)
        self.end_headers()
        self.wfile.write(
            self.callback_template
            .render(
                lang=&#34;en&#34;,
                title=title,
                message=message,
                has_error=has_error
            )
            .encode(&#34;utf-8&#34;)
        )


class OAuthCallbackHttpServer(HTTPServer):
    &#34;&#34;&#34;
    Simplistic HTTP Server to provide local callback URL for oauth2 provider
    &#34;&#34;&#34;

    def __init__(self, port):
        super().__init__((&#34;&#34;, port), OAuthRedirectHandler)

        self._code = None

    def get_code(self):
        return self._code

    @property
    def callback_url(self):
        return f&#34;http://localhost:{self.server_port}&#34;

    def wait_for_code(self, attempts: int = 3, timeout_per_attempt=10) -&gt; Optional[str]:
        &#34;&#34;&#34;
        Wait for the server to open the callback page containing the code query parameter.

        It tries for #attempts with a timeout of #timeout_per_attempts for each attempt.
        This prevents the CLI from getting stuck by unsolved callback URls

        :param attempts: Amount of attempts
        :param timeout_per_attempt: Timeout for each attempt to be successful
        :return: Code from callback page or None if the callback page is not called successfully
        &#34;&#34;&#34;
        for i in range(0, attempts):
            try:
                _method_with_timeout(self.handle_request, timeout_seconds=timeout_per_attempt)
            except TimeoutException:
                continue
            if self.get_code() is not None:
                return self.get_code()

        return None</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="oauth2_cli_auth.http_server.CallbackPageTemplate"><code class="flex name class">
<span>class <span class="ident">CallbackPageTemplate</span></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CallbackPageTemplate:
    SUCCESS_SVG = &#34;&#34;&#34;
    &lt;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; width=&#34;154px&#34; height=&#34;154px&#34;&gt;
        &lt;g fill=&#34;none&#34; stroke=&#34;#22AE73&#34; stroke-width=&#34;2&#34;&gt;
            &lt;circle cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;circle id=&#34;colored&#34; fill=&#34;#22AE73&#34; cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;polyline class=&#34;st0&#34; stroke=&#34;#fff&#34; stroke-width=&#34;10&#34; points=&#34;43.5,77.8 63.7,97.9 112.2,49.4 &#34; style=&#34;stroke-dasharray:100px, 100px; stroke-dashoffset: 200px;&#34;/&gt;
        &lt;/g&gt;
    &lt;/svg&gt;
    &#34;&#34;&#34;

    ERROR_SVG = &#34;&#34;&#34;
    &lt;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; width=&#34;154px&#34; height=&#34;154px&#34;&gt;
        &lt;g fill=&#34;none&#34; stroke=&#34;#F44812&#34; stroke-width=&#34;2&#34;&gt;
            &lt;circle cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;circle id=&#34;colored&#34; fill=&#34;#F44812&#34; cx=&#34;77&#34; cy=&#34;77&#34; r=&#34;72&#34; style=&#34;stroke-dasharray:480px, 480px; stroke-dashoffset: 960px;&#34;&gt;&lt;/circle&gt;
            &lt;polyline class=&#34;st0&#34; stroke=&#34;#fff&#34; stroke-width=&#34;10&#34; points=&#34;43.5,77.8  112.2,77.8 &#34; style=&#34;stroke-dasharray:100px, 100px; stroke-dashoffset: 200px;&#34;/&gt;
        &lt;/g&gt;
    &lt;/svg&gt;
    &#34;&#34;&#34;

    PAGE_TEMPLATE = Template(&#34;&#34;&#34;
    &lt;html lang=&#34;$lang&#34;&gt;
        &lt;head&gt;
            &lt;title&gt;$title&lt;/title&gt;
            &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;/&gt;
            &lt;meta name=&#34;charset&#34; content=&#34;utf-8&#34;&gt;
            &lt;style&gt;
                * {
                    margin: 0;
                    padding: 0;
                }

                body {
                    font-family: -apple-system, BlinkMacSystemFont, &#34;Segoe UI&#34;, Roboto, Helvetica, Arial, sans-serif, &#34;Apple Color Emoji&#34;, &#34;Segoe UI Emoji&#34;, &#34;Segoe UI Symbol&#34;;
                }

                @media (prefers-color-scheme: dark) {
                    body {
                        background: rgb(34, 39, 46);
                        color: rgb(173, 186, 199);
                    }
                }

                html, body {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    height: 100%;
                }

                h1 {
                    font-size: 4rem;
                }

                p {
                    font-size: 1.4rem;
                    max-width: 70ch;
                }

                .message {
                    text-align: center;
                }

                .animation-ctn {
                    text-align: center;
                }

                @keyframes checkmark {
                    0% {
                        stroke-dashoffset: 100px
                    }

                    100% {
                        stroke-dashoffset: 0px
                    }
                }

                @keyframes checkmark-circle {
                    0% {
                        stroke-dashoffset: 480px
                    }

                    100% {
                        stroke-dashoffset: 960px
                    }
                }

                @keyframes colored-circle {
                    0% {
                        opacity: 0
                    }

                    100% {
                        opacity: 100
                    }
                }

                .icon svg {
                    padding: 1rem;
                }

                .icon svg polyline {
                    -webkit-animation: checkmark 0.25s ease-in-out 0.7s backwards;
                    animation: checkmark 0.25s ease-in-out 0.7s backwards
                }

                .icon svg circle {
                    -webkit-animation: checkmark-circle 0.6s ease-in-out backwards;
                    animation: checkmark-circle 0.6s ease-in-out backwards;
                }

                .icon svg circle#colored {
                    -webkit-animation: colored-circle 0.6s ease-in-out 0.7s backwards;
                    animation: colored-circle 0.6s ease-in-out 0.7s backwards;
                }
            &lt;/style&gt;
        &lt;/head&gt;

        &lt;body&gt;
        &lt;div class=&#34;message&#34;&gt;
            &lt;div class=&#34;animation-ctn&#34;&gt;
                &lt;div class=&#34;icon&#34;&gt;
                    $svg
                &lt;/div&gt;
            &lt;/div&gt;

            &lt;h1&gt;$title&lt;/h1&gt;
            &lt;p&gt;$message&lt;/p&gt;
        &lt;/div&gt;
        &lt;/body&gt;
        &lt;/html&gt;
        &#34;&#34;&#34;)

    def render(self, title: str, message: str, lang: str = &#34;en&#34;, has_error: bool = False):
        return self.PAGE_TEMPLATE.substitute(
            lang=lang,
            title=title,
            message=message,
            svg=self.ERROR_SVG if has_error else self.SUCCESS_SVG,
        )</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="oauth2_cli_auth.http_server.CallbackPageTemplate.ERROR_SVG"><code class="name">var <span class="ident">ERROR_SVG</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="oauth2_cli_auth.http_server.CallbackPageTemplate.PAGE_TEMPLATE"><code class="name">var <span class="ident">PAGE_TEMPLATE</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="oauth2_cli_auth.http_server.CallbackPageTemplate.SUCCESS_SVG"><code class="name">var <span class="ident">SUCCESS_SVG</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="oauth2_cli_auth.http_server.CallbackPageTemplate.render"><code class="name flex">
<span>def <span class="ident">render</span></span>(<span>self, title: str, message: str, lang: str = 'en', has_error: bool = False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def render(self, title: str, message: str, lang: str = &#34;en&#34;, has_error: bool = False):
    return self.PAGE_TEMPLATE.substitute(
        lang=lang,
        title=title,
        message=message,
        svg=self.ERROR_SVG if has_error else self.SUCCESS_SVG,
    )</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="oauth2_cli_auth.http_server.OAuthCallbackHttpServer"><code class="flex name class">
<span>class <span class="ident">OAuthCallbackHttpServer</span></span>
<span>(</span><span>port)</span>
</code></dt>
<dd>
<div class="desc"><p>Simplistic HTTP Server to provide local callback URL for oauth2 provider</p>
<p>Constructor.
May be extended, do not override.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OAuthCallbackHttpServer(HTTPServer):
    &#34;&#34;&#34;
    Simplistic HTTP Server to provide local callback URL for oauth2 provider
    &#34;&#34;&#34;

    def __init__(self, port):
        super().__init__((&#34;&#34;, port), OAuthRedirectHandler)

        self._code = None

    def get_code(self):
        return self._code

    @property
    def callback_url(self):
        return f&#34;http://localhost:{self.server_port}&#34;

    def wait_for_code(self, attempts: int = 3, timeout_per_attempt=10) -&gt; Optional[str]:
        &#34;&#34;&#34;
        Wait for the server to open the callback page containing the code query parameter.

        It tries for #attempts with a timeout of #timeout_per_attempts for each attempt.
        This prevents the CLI from getting stuck by unsolved callback URls

        :param attempts: Amount of attempts
        :param timeout_per_attempt: Timeout for each attempt to be successful
        :return: Code from callback page or None if the callback page is not called successfully
        &#34;&#34;&#34;
        for i in range(0, attempts):
            try:
                _method_with_timeout(self.handle_request, timeout_seconds=timeout_per_attempt)
            except TimeoutException:
                continue
            if self.get_code() is not None:
                return self.get_code()

        return None</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>http.server.HTTPServer</li>
<li>socketserver.TCPServer</li>
<li>socketserver.BaseServer</li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="oauth2_cli_auth.http_server.OAuthCallbackHttpServer.callback_url"><code class="name">var <span class="ident">callback_url</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def callback_url(self):
    return f&#34;http://localhost:{self.server_port}&#34;</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="oauth2_cli_auth.http_server.OAuthCallbackHttpServer.get_code"><code class="name flex">
<span>def <span class="ident">get_code</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_code(self):
    return self._code</code></pre>
</details>
</dd>
<dt id="oauth2_cli_auth.http_server.OAuthCallbackHttpServer.wait_for_code"><code class="name flex">
<span>def <span class="ident">wait_for_code</span></span>(<span>self, attempts: int = 3, timeout_per_attempt=10) ‑> Optional[str]</span>
</code></dt>
<dd>
<div class="desc"><p>Wait for the server to open the callback page containing the code query parameter.</p>
<p>It tries for #attempts with a timeout of #timeout_per_attempts for each attempt.
This prevents the CLI from getting stuck by unsolved callback URls</p>
<p>:param attempts: Amount of attempts
:param timeout_per_attempt: Timeout for each attempt to be successful
:return: Code from callback page or None if the callback page is not called successfully</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wait_for_code(self, attempts: int = 3, timeout_per_attempt=10) -&gt; Optional[str]:
    &#34;&#34;&#34;
    Wait for the server to open the callback page containing the code query parameter.

    It tries for #attempts with a timeout of #timeout_per_attempts for each attempt.
    This prevents the CLI from getting stuck by unsolved callback URls

    :param attempts: Amount of attempts
    :param timeout_per_attempt: Timeout for each attempt to be successful
    :return: Code from callback page or None if the callback page is not called successfully
    &#34;&#34;&#34;
    for i in range(0, attempts):
        try:
            _method_with_timeout(self.handle_request, timeout_seconds=timeout_per_attempt)
        except TimeoutException:
            continue
        if self.get_code() is not None:
            return self.get_code()

    return None</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="oauth2_cli_auth.http_server.OAuthRedirectHandler"><code class="flex name class">
<span>class <span class="ident">OAuthRedirectHandler</span></span>
<span>(</span><span>request, client_address, server)</span>
</code></dt>
<dd>
<div class="desc"><p>HTTP request handler base class.</p>
<p>The following explanation of HTTP serves to guide you through the
code as well as to expose any misunderstandings I may have about
HTTP (so you don't need to read the code to figure out I'm wrong
:-).</p>
<p>HTTP (HyperText Transfer Protocol) is an extensible protocol on
top of a reliable stream transport (e.g. TCP/IP).
The protocol
recognizes three parts to a request:</p>
<ol>
<li>One line identifying the request type and path</li>
<li>An optional set of RFC-822-style headers</li>
<li>An optional data part</li>
</ol>
<p>The headers and data are separated by a blank line.</p>
<p>The first line of the request has the form</p>
<p><command> <path> <version></p>
<p>where <command> is a (case-sensitive) keyword such as GET or POST,
<path> is a string containing path information for the request,
and <version> should be the string "HTTP/1.0" or "HTTP/1.1".
<path> is encoded using the URL encoding scheme (using %xx to signify
the ASCII character with hex code xx).</p>
<p>The specification specifies that lines are separated by CRLF but
for compatibility with the widest range of clients recommends
servers also handle LF.
Similarly, whitespace in the request line
is treated sensibly (allowing multiple spaces between components
and allowing trailing whitespace).</p>
<p>Similarly, for output, lines ought to be separated by CRLF pairs
but most clients grok LF characters just fine.</p>
<p>If the first line of the request has the form</p>
<p><command> <path></p>
<p>(i.e. <version> is left out) then this is assumed to be an HTTP
0.9 request; this form has no optional headers and data part and
the reply consists of just the data.</p>
<p>The reply form of the HTTP 1.x protocol again has three parts:</p>
<ol>
<li>One line giving the response code</li>
<li>An optional set of RFC-822-style headers</li>
<li>The data</li>
</ol>
<p>Again, the headers and data are separated by a blank line.</p>
<p>The response code line has the form</p>
<p><version> <responsecode> <responsestring></p>
<p>where <version> is the protocol version ("HTTP/1.0" or "HTTP/1.1"),
<responsecode> is a 3-digit response code indicating success or
failure of the request, and <responsestring> is an optional
human-readable string explaining what the response code means.</p>
<p>This server parses the request and the headers, and then calls a
function specific to the request type (<command>).
Specifically,
a request SPAM will be handled by a method do_SPAM().
If no
such method exists the server sends an error response to the
client.
If it exists, it is called with no arguments:</p>
<p>do_SPAM()</p>
<p>Note that the request name is case sensitive (i.e. SPAM and spam
are different requests).</p>
<p>The various request details are stored in instance variables:</p>
<ul>
<li>
<p>client_address is the client IP address in the form (host,
port);</p>
</li>
<li>
<p>command, path and version are the broken-down request line;</p>
</li>
<li>
<p>headers is an instance of email.message.Message (or a derived
class) containing the header information;</p>
</li>
<li>
<p>rfile is a file object open for reading positioned at the
start of the optional input data part;</p>
</li>
<li>
<p>wfile is a file object open for writing.</p>
</li>
</ul>
<p>IT IS IMPORTANT TO ADHERE TO THE PROTOCOL FOR WRITING!</p>
<p>The first thing to be written must be the response line.
Then
follow 0 or more header lines, then a blank line, and then the
actual data (if any).
The meaning of the header lines depends on
the command executed by the server; in most cases, when data is
returned, there should be at least one header line of the form</p>
<p>Content-type: <type>/<subtype></p>
<p>where <type> and <subtype> should be registered MIME types,
e.g. "text/html" or "text/plain".</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OAuthRedirectHandler(BaseHTTPRequestHandler):
    callback_template = CallbackPageTemplate()

    def log_message(self, format, *args):
        # silence the log messages
        pass

    def do_GET(self):
        params = parse_qs(urlparse(self.path).query)

        has_error = &#34;code&#34; not in params or len(params[&#39;code&#39;]) != 1 or params[&#39;code&#39;][0].strip() == &#34;&#34;

        if has_error:
            self.send_response(400)
            title = &#34;Oh snap!&#34;
            message = &#34;Something went wrong trying to authenticate you. Please try going back in your browser, or restart the auth process.&#34;
        else:
            self.send_response(200)
            self.server._code = params[&#34;code&#34;][0]
            title = &#34;Success&#34;
            message = &#34;You have been authenticated successfully. You may close this browser window now and go back to the terminal&#34;

        self.send_header(&#34;Content-type&#34;, &#34;text/html&#34;)
        self.end_headers()
        self.wfile.write(
            self.callback_template
            .render(
                lang=&#34;en&#34;,
                title=title,
                message=message,
                has_error=has_error
            )
            .encode(&#34;utf-8&#34;)
        )</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>http.server.BaseHTTPRequestHandler</li>
<li>socketserver.StreamRequestHandler</li>
<li>socketserver.BaseRequestHandler</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="oauth2_cli_auth.http_server.OAuthRedirectHandler.callback_template"><code class="name">var <span class="ident">callback_template</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="oauth2_cli_auth.http_server.OAuthRedirectHandler.do_GET"><code class="name flex">
<span>def <span class="ident">do_GET</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def do_GET(self):
    params = parse_qs(urlparse(self.path).query)

    has_error = &#34;code&#34; not in params or len(params[&#39;code&#39;]) != 1 or params[&#39;code&#39;][0].strip() == &#34;&#34;

    if has_error:
        self.send_response(400)
        title = &#34;Oh snap!&#34;
        message = &#34;Something went wrong trying to authenticate you. Please try going back in your browser, or restart the auth process.&#34;
    else:
        self.send_response(200)
        self.server._code = params[&#34;code&#34;][0]
        title = &#34;Success&#34;
        message = &#34;You have been authenticated successfully. You may close this browser window now and go back to the terminal&#34;

    self.send_header(&#34;Content-type&#34;, &#34;text/html&#34;)
    self.end_headers()
    self.wfile.write(
        self.callback_template
        .render(
            lang=&#34;en&#34;,
            title=title,
            message=message,
            has_error=has_error
        )
        .encode(&#34;utf-8&#34;)
    )</code></pre>
</details>
</dd>
<dt id="oauth2_cli_auth.http_server.OAuthRedirectHandler.log_message"><code class="name flex">
<span>def <span class="ident">log_message</span></span>(<span>self, format, *args)</span>
</code></dt>
<dd>
<div class="desc"><p>Log an arbitrary message.</p>
<p>This is used by all other logging functions.
Override
it if you have specific logging wishes.</p>
<p>The first argument, FORMAT, is a format string for the
message to be logged.
If the format string contains
any % escapes requiring parameters, they should be
specified as subsequent arguments (it's just like
printf!).</p>
<p>The client ip and current date/time are prefixed to
every message.</p>
<p>Unicode control characters are replaced with escaped hex
before writing the output to stderr.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def log_message(self, format, *args):
    # silence the log messages
    pass</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="oauth2_cli_auth" href="index.html">oauth2_cli_auth</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="oauth2_cli_auth.http_server.CallbackPageTemplate" href="#oauth2_cli_auth.http_server.CallbackPageTemplate">CallbackPageTemplate</a></code></h4>
<ul class="">
<li><code><a title="oauth2_cli_auth.http_server.CallbackPageTemplate.ERROR_SVG" href="#oauth2_cli_auth.http_server.CallbackPageTemplate.ERROR_SVG">ERROR_SVG</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.CallbackPageTemplate.PAGE_TEMPLATE" href="#oauth2_cli_auth.http_server.CallbackPageTemplate.PAGE_TEMPLATE">PAGE_TEMPLATE</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.CallbackPageTemplate.SUCCESS_SVG" href="#oauth2_cli_auth.http_server.CallbackPageTemplate.SUCCESS_SVG">SUCCESS_SVG</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.CallbackPageTemplate.render" href="#oauth2_cli_auth.http_server.CallbackPageTemplate.render">render</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="oauth2_cli_auth.http_server.OAuthCallbackHttpServer" href="#oauth2_cli_auth.http_server.OAuthCallbackHttpServer">OAuthCallbackHttpServer</a></code></h4>
<ul class="">
<li><code><a title="oauth2_cli_auth.http_server.OAuthCallbackHttpServer.callback_url" href="#oauth2_cli_auth.http_server.OAuthCallbackHttpServer.callback_url">callback_url</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.OAuthCallbackHttpServer.get_code" href="#oauth2_cli_auth.http_server.OAuthCallbackHttpServer.get_code">get_code</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.OAuthCallbackHttpServer.wait_for_code" href="#oauth2_cli_auth.http_server.OAuthCallbackHttpServer.wait_for_code">wait_for_code</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="oauth2_cli_auth.http_server.OAuthRedirectHandler" href="#oauth2_cli_auth.http_server.OAuthRedirectHandler">OAuthRedirectHandler</a></code></h4>
<ul class="">
<li><code><a title="oauth2_cli_auth.http_server.OAuthRedirectHandler.callback_template" href="#oauth2_cli_auth.http_server.OAuthRedirectHandler.callback_template">callback_template</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.OAuthRedirectHandler.do_GET" href="#oauth2_cli_auth.http_server.OAuthRedirectHandler.do_GET">do_GET</a></code></li>
<li><code><a title="oauth2_cli_auth.http_server.OAuthRedirectHandler.log_message" href="#oauth2_cli_auth.http_server.OAuthRedirectHandler.log_message">log_message</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>